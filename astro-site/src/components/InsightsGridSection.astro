---
// Insights Grid Section Component with Filtering and Pagination
---

<section class="insights-grid-section">
    <div class="container mx-auto px-4">
        <h2 class="text-center mb-4 text-3xl font-bold text-white" data-i18n="insights.latest.title">Latest Insights</h2>
        
        <!-- Filter Buttons -->
        <div class="insights-filter text-center mb-5">
            <button class="filter-button active" data-filter="all" data-i18n="insights.filter.all">All Topics</button>
            <div id="category-filters" class="d-inline-block">
                <!-- Category filters will be dynamically inserted here -->
            </div>
        </div>
        
        <!-- Insights Cards -->
        <div class="insights-grid" id="insights-grid">
            <!-- Blog post cards will be dynamically inserted here -->
        </div>
        
        <!-- Pagination -->
        <div class="pagination-container d-flex justify-center mt-5" id="pagination-container">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <!-- Pagination will be dynamically generated by JavaScript -->
                </ul>
            </nav>
        </div>
    </div>
</section>

<style>
    :root {
        --dark-bg: #121212;
        --dark-surface: #1e1e1e;
        --primary-color: #0066FF;
        --accent-color: #00C2FF;
        --text-medium: #94a3b8;
    }
    
    /* Insights Grid Section Background */
    .insights-grid-section {
        background: #1e293b;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        padding: 80px 0;
        position: relative;
    }
    
    .insights-grid-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
        pointer-events: none;
    }
    
    .insights-filter {
        margin-bottom: 40px;
    }
    
    .filter-button {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-medium);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 30px;
        padding: 8px 20px;
        margin: 0 5px 10px;
        transition: all 0.3s ease;
        cursor: pointer;
        font-size: 0.9rem;
    }
    
    .filter-button:hover, .filter-button.active {
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        border-color: transparent;
    }
    
    .insights-card {
        background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
        height: 100%;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        margin-bottom: 30px;
    }
    
    .insights-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        border-color: var(--primary-color);
    }
    
    .insights-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(16, 185, 129, 0.1));
    }
    
    .insights-content {
        padding: 25px;
    }
    
    .insights-date {
        color: var(--text-medium);
        font-size: 0.85rem;
        margin-bottom: 5px;
    }
    
    .insights-category {
        display: inline-block;
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        font-size: 0.75rem;
        padding: 3px 10px;
        border-radius: 20px;
        margin-bottom: 15px;
    }
    
    .insights-title {
        font-size: 1.25rem;
        margin-bottom: 15px;
        line-height: 1.4;
        color: white;
        font-weight: 600;
    }
    
    .insights-excerpt {
        color: var(--text-medium);
        margin-bottom: 20px;
        font-size: 0.95rem;
        line-height: 1.6;
    }
    
    .insights-read-more {
        color: var(--primary-color);
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .insights-read-more svg {
        margin-left: 5px;
        transition: all 0.3s ease;
    }
    
    .insights-read-more:hover {
        color: var(--accent-color);
    }
    
    .insights-read-more:hover svg {
        transform: translateX(5px);
    }
    
    .pagination-container {
        margin-top: 50px;
    }
    
    .pagination {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
        gap: 5px;
    }
    
    .pagination .page-link {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-medium);
        padding: 8px 15px;
        border-radius: 5px;
        transition: all 0.3s ease;
        cursor: pointer;
        text-decoration: none;
        display: block;
    }
    
    .pagination .page-link:hover, .pagination .page-item.active .page-link {
        background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
        color: white;
        border-color: transparent;
    }
    
    .insights-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
    }
    
    @media (min-width: 768px) {
        .insights-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (min-width: 1024px) {
        .insights-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    .insights-grid > div {
        width: 100%;
    }
    
    .insights-card-wrapper {
        width: 100%;
    }
    
    .d-inline-block {
        display: inline-block;
    }
    
    .d-flex {
        display: flex;
    }
    
    .justify-center {
        justify-content: center;
    }
    
    .text-center {
        text-align: center;
    }
    
    .mb-4 {
        margin-bottom: 1rem;
    }
    
    .mb-5 {
        margin-bottom: 3rem;
    }
    
    .mt-5 {
        margin-top: 3rem;
    }
</style>

<script is:inline>
    // Blog post loader and filtering functionality
    (function() {
        // Pagination variables
        let currentPage = 1;
        const postsPerPage = 6;
        let allPosts = [];
        let filteredPosts = [];
        
        // Slugify function
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-')
                .replace(/^-+/, '')
                .replace(/-+$/, '');
        }
        
        // Format date function
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('en-US', options);
        }
        
        // Truncate text function
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substr(0, maxLength) + '...';
        }
        
        // Load blog posts
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/assets/data/blog-posts.json?v=' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    processBlogPosts(data.posts);
                })
                .catch(() => {
                    displayErrorMessage();
                });
        });
        
        // Process blog posts
        function processBlogPosts(posts) {
            if (!posts || posts.length === 0) {
                displayErrorMessage('No blog posts found');
                return;
            }
            
            allPosts = posts;
            filteredPosts = posts;
            
            // Set featured post (first post)
            setFeaturedPost(posts[0]);
            
            // Generate category filters
            generateCategoryFilters(posts);
            
            // Initialize pagination
            paginatePosts(currentPage);
            
            // Initialize filter functionality
            initializeFilters();
            
            // Initialize pagination functionality
            initializePagination();
        }
        
        // Set featured post
        function setFeaturedPost(post) {
            const featuredTitle = document.getElementById('featured-title');
            const featuredExcerpt = document.getElementById('featured-excerpt');
            const featuredLink = document.getElementById('featured-link');
            
            if (featuredTitle && featuredExcerpt && featuredLink && post) {
                featuredTitle.textContent = post.title;
                featuredExcerpt.textContent = post.excerpt;
                featuredLink.href = post.url;
            }
        }
        
        // Generate category filters
        function generateCategoryFilters(posts) {
            const categoryFiltersContainer = document.getElementById('category-filters');
            if (!categoryFiltersContainer) return;
            
            const categories = new Set();
            posts.forEach(post => {
                if (post.categories && post.categories.length > 0) {
                    post.categories.forEach(category => categories.add(category));
                }
            });
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-button';
                button.setAttribute('data-filter', slugify(category));
                button.textContent = category;
                categoryFiltersContainer.appendChild(button);
            });
        }
        
        // Initialize filters
        function initializeFilters() {
            const filterButtons = document.querySelectorAll('.filter-button');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filterValue = this.getAttribute('data-filter');
                    filterInsights(filterValue);
                });
            });
        }
        
        // Filter insights
        function filterInsights(filter) {
            if (filter === 'all') {
                filteredPosts = allPosts;
            } else {
                filteredPosts = allPosts.filter(post => {
                    if (post.categories && post.categories.length > 0) {
                        return post.categories.some(category => slugify(category) === filter);
                    }
                    return false;
                });
            }
            
            currentPage = 1;
            paginatePosts(currentPage);
        }
        
        // Paginate posts
        function paginatePosts(page) {
            const insightsGrid = document.getElementById('insights-grid');
            if (!insightsGrid) return;
            
            insightsGrid.innerHTML = '';
            
            const startIndex = (page - 1) * postsPerPage;
            const endIndex = startIndex + postsPerPage;
            const postsToShow = filteredPosts.slice(startIndex, endIndex);
            
            postsToShow.forEach((post, index) => {
                const card = createPostCard(post, index);
                insightsGrid.appendChild(card);
            });
            
            // Generate pagination
            generatePagination();
        }
        
        // Create post card
        function createPostCard(post, index) {
            const cardCol = document.createElement('div');
            cardCol.className = 'insights-card-wrapper';
            
            if (post.categories && post.categories.length > 0) {
                cardCol.setAttribute('data-topic', slugify(post.categories[0]));
            }
            
            const displayDate = formatDate(post.date);
            const category = post.categories && post.categories.length > 0 ? post.categories[0] : '';
            
            const cardHtml = `
                <div class="insights-card">
                    <div class="insights-image"></div>
                    <div class="insights-content">
                        <div class="insights-date">${displayDate}</div>
                        ${category ? `<span class="insights-category">${category}</span>` : ''}
                        <h3 class="insights-title">${post.title}</h3>
                        <p class="insights-excerpt">${truncateText(post.excerpt, 120)}</p>
                        <a href="${post.url}" class="insights-read-more" data-i18n="insights.read.more">
                            Read More
                            <svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                            </svg>
                        </a>
                    </div>
                </div>
            `;
            
            cardCol.innerHTML = cardHtml;
            return cardCol;
        }
        
        // Generate pagination
        function generatePagination() {
            const paginationContainer = document.getElementById('pagination-container');
            if (!paginationContainer) return;
            
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            const paginationUl = paginationContainer.querySelector('.pagination');
            if (!paginationUl) return;
            
            paginationUl.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>`;
            paginationUl.appendChild(prevLi);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                paginationUl.appendChild(li);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>`;
            paginationUl.appendChild(nextLi);
        }
        
        // Initialize pagination
        function initializePagination() {
            const paginationContainer = document.getElementById('pagination-container');
            if (!paginationContainer) return;
            
            paginationContainer.addEventListener('click', function(e) {
                e.preventDefault();
                const pageLink = e.target.closest('.page-link');
                if (!pageLink) return;
                
                const page = parseInt(pageLink.getAttribute('data-page'));
                if (page && page !== currentPage && page > 0) {
                    const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
                    if (page <= totalPages) {
                        currentPage = page;
                        paginatePosts(currentPage);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                }
            });
        }
        
        // Display error message
        function displayErrorMessage(message = 'Failed to load blog posts') {
            const insightsGrid = document.getElementById('insights-grid');
            if (insightsGrid) {
                insightsGrid.innerHTML = `<div class="col-12 text-center text-white">${message}</div>`;
            }
        }
    })();
</script>

