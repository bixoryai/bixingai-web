---
// Insights Grid Section Component with Filtering and Pagination
---

<section class="section-secondary">
    <div class="container mx-auto">
        <h2 class="section-title text-center mb-4" data-aos="fade-up" data-i18n="insights.latest.title">Latest Insights</h2>

        <!-- Filter Buttons -->
        <div class="insights-filter text-center mb-12" data-aos="fade-up">
            <button class="btn filter-button active" data-filter="all" data-i18n="insights.filter.all">All Topics</button>
            <div id="category-filters" class="inline-block">
                <!-- Category filters will be dynamically inserted here -->
            </div>
        </div>

        <!-- Insights Cards - Matching Jekyll's 2-column layout -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-[30px]" id="insights-grid">
            <!-- Blog post cards will be dynamically inserted here -->
        </div>

        <!-- Pagination -->
        <div class="pagination-container flex justify-center mt-12" data-aos="fade-up" id="pagination-container">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    <!-- Pagination will be dynamically generated by JavaScript -->
                </ul>
            </nav>
        </div>
    </div>
</section>

    <script is:inline>
        // Blog post translations - now using the page-level translation system
        // This will be set by the parent page's translation system

        // Function to translate blog post content using page-level translations
        function translateBlogPost(post) {
            const currentLang = localStorage.getItem('bixingLanguage') || 'en';

            // Wait for insightsTranslations to be available
            if (!window.insightsTranslations) {
                console.log('Waiting for insightsTranslations to load...');
                return post;
            }

            const translations = window.insightsTranslations[currentLang];

            // Translate title and excerpt
            let translatedPost = { ...post };

            if (translations && translations[post.title]) {
                translatedPost.title = translations[post.title].title;
                translatedPost.excerpt = translations[post.title].excerpt;
            }

            // Translate categories
            if (post.categories && Array.isArray(post.categories)) {
                translatedPost.categories = post.categories.map(category => {
                    return translations[category] || category;
                });
            }

            return translatedPost;
        }

        // Function to re-translate all displayed posts when language changes
        function retranslateAllPosts() {
            const currentLang = localStorage.getItem('bixingLanguage') || 'en';
            console.log('Re-translating blog posts for language:', currentLang);

            if (allPosts && allPosts.length > 0) {
                const translatedPosts = allPosts.map(post => translateBlogPost(post));

                // Update filtered posts
                filteredPosts = translatedPosts;

                // Re-render current page
                paginatePosts(currentPage);

                // Update featured post if it exists
                if (translatedPosts.length > 0) {
                    setFeaturedPost(translatedPosts[0]);
                }

                console.log('Blog posts re-translated successfully');
            }
        }

        // Listen for language toggle events
        document.addEventListener('languageToggled', function(e) {
            console.log('Language toggled on insights page - re-translating blog posts');
            // Small delay to ensure DOM is updated
            setTimeout(function() {
                retranslateAllPosts();
            }, 100);
        });

        // Also listen for storage events
        window.addEventListener('storage', function(e) {
            if (e.key === 'bixingLanguage') {
                console.log('Language storage event on insights page - re-translating blog posts');
                // Small delay to ensure DOM is updated
                setTimeout(function() {
                    retranslateAllPosts();
                }, 100);
            }
        });

        // Force initial translation on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Insights page loaded - forcing initial blog post translations');
            setTimeout(function() {
                retranslateAllPosts();
            }, 500);
        });
    </script>

    <style is:global>
    :root {
        --dark-bg: #121212;
        --dark-surface: #1e1e1e;
        --primary-color: #0066FF;
        --accent-color: #00C2FF;
        --text-medium: #94a3b8;
        --white: #ffffff;
        --primary-gradient: linear-gradient(135deg, var(--primary-color), var(--accent-color));
    }

    /* Insights card styling - matching Jekyll exactly */
    /* Using :global to apply to dynamically generated cards */
    .insights-card {
        background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
        border-radius: 12px;
        overflow: hidden;
        transition: all 0.3s ease;
        height: 100%;
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .insights-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        border-color: var(--primary-color);
    }

    /* Card image container - matching Jekyll's insight-img class */
    .insight-img {
        width: 100%;
        height: 200px;
        position: relative;
        overflow: hidden;
    }

    .insights-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* AI-themed overlay and pattern - matching Jekyll */
    .insight-ai-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 102, 255, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
    }

    .insights-card:hover .insight-ai-overlay {
        opacity: 0.2;
    }

    .insight-ai-pattern {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm63 31c1.657 0 3-1.343 3-3s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM34 90c1.657 0 3-1.343 3-3s-.895-2-2-2-2 .895-2 2 .895 2 2 2zm56-76c1.657 0 3-1.343 3-3s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
        background-size: 100px 100px;
        opacity: 0.3;
        z-index: 0;
    }

    .insights-content {
        padding: 25px;
    }

    .insights-date {
        color: var(--text-medium);
        font-size: 0.85rem;
        margin-bottom: 5px;
    }

    .insights-category {
        display: inline-block;
        background: var(--primary-gradient);
        color: var(--white);
        font-size: 0.75rem;
        padding: 3px 10px;
        border-radius: 20px;
        margin-bottom: 15px;
    }

    .insights-title {
        font-size: 1.25rem;
        margin-bottom: 15px;
        line-height: 1.4;
        font-weight: 600;
        /* Gold/orange gradient text - matching Jekyll exactly */
        background: linear-gradient(135deg, #f59e0b, #f97316);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .insights-excerpt {
        color: var(--text-medium);
        margin-bottom: 20px;
        font-size: 0.95rem;
        line-height: 1.6;
    }

    .insights-read-more {
        color: var(--primary-color);
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .insights-read-more i,
    .insights-read-more svg {
        margin-left: 5px;
        transition: all 0.3s ease;
        width: 12px;
        height: 12px;
    }

    .insights-read-more:hover {
        color: var(--accent-color);
    }

    .insights-read-more:hover i,
    .insights-read-more:hover svg {
        transform: translateX(5px);
    }

    /* Filter buttons - matching Jekyll exactly */
    .insights-filter {
        margin-bottom: 40px;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 10px;
    }

    /* Section title styling - matching Jekyll's large h2 */
    #insights-grid + .pagination-container,
    .section-secondary .section-title {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--white);
        margin-bottom: 1.5rem;
        text-align: center !important;
        width: 100%;
        display: block;
    }

    .filter-button {
        background: rgba(255, 255, 255, 0.05);
        color: var(--text-medium);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 30px;
        padding: 8px 20px;
        margin: 0 5px 10px;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        cursor: pointer;
    }

    .filter-button:hover, .filter-button.active {
        background: var(--primary-gradient);
        color: var(--white);
        border-color: transparent;
    }

    /* Pagination styling */
    .pagination-container {
        margin-top: 50px;
    }

    .pagination .page-link {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-medium);
        margin: 0 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
    }

    .pagination .page-link:hover, .pagination .page-item.active .page-link {
        background: var(--primary-gradient);
        color: var(--white);
        border-color: transparent;
    }

    /* Section background - matching Jekyll exactly */
    .section-secondary {
        background: #1e293b;
        border-top: 1px solid rgba(255, 255, 255, 0.05);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        position: relative;
        padding: 80px 0;
    }

    .section-secondary::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.05) 0%, transparent 50%);
        pointer-events: none;
    }

    /* Container - matching Bootstrap's responsive max-widths for parity */
    .container {
        width: 100%;
        padding-right: 15px;
        padding-left: 15px;
        margin-right: auto;
        margin-left: auto;
    }

    @media (min-width: 576px) {
        .container {
            max-width: 540px;
        }
    }

    @media (min-width: 768px) {
        .container {
            max-width: 720px;
        }
    }

    @media (min-width: 992px) {
        .container {
            max-width: 960px;
        }
    }

    @media (min-width: 1200px) {
        .container {
            max-width: 1140px;
        }
    }

    @media (min-width: 1400px) {
        .container {
            max-width: 1320px;
        }
    }
</style>

<script is:inline>
    // Blog post loader and filtering functionality
    (function() {
        // Pagination variables
        let currentPage = 1;
        const postsPerPage = 6;
        let allPosts = [];
        let filteredPosts = [];
        
        // Slugify function
        function slugify(text) {
            return text.toString().toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w\-]+/g, '')
                .replace(/\-\-+/g, '-')
                .replace(/^-+/, '')
                .replace(/-+$/, '');
        }
        
        // Format date function
        function formatDate(dateString) {
            const date = new Date(dateString);
            const currentLang = localStorage.getItem('bixingLanguage') || 'en';

            if (currentLang === 'zh') {
                // Chinese date format: YYYY年MM月DD日
                const year = date.getFullYear();
                const month = date.getMonth() + 1; // getMonth() returns 0-11
                const day = date.getDate();
                return `${year}年${month}月${day}日`;
            } else {
                // English date format
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return date.toLocaleDateString('en-US', options);
            }
        }
        
        // Truncate text function
        function truncateText(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substr(0, maxLength) + '...';
        }
        
        // Load blog posts
        document.addEventListener('DOMContentLoaded', function() {
            fetch('/assets/data/blog-posts.json?v=' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    processBlogPosts(data.posts);
                })
                .catch(() => {
                    displayErrorMessage();
                });
        });
        
        // Process blog posts
        function processBlogPosts(posts) {
            if (!posts || posts.length === 0) {
                displayErrorMessage('No blog posts found');
                return;
            }

            console.log('Processing', posts.length, 'blog posts');

            // Wait for insightsTranslations to be available
            function waitForTranslations() {
                if (!window.insightsTranslations) {
                    console.log('Waiting for insightsTranslations...');
                    setTimeout(waitForTranslations, 100);
                    return;
                }

                // Translate blog posts based on current language
                const translatedPosts = posts.map(post => translateBlogPost(post));

                allPosts = translatedPosts;
                filteredPosts = translatedPosts;

                console.log('Translated posts for language:', localStorage.getItem('bixingLanguage') || 'en');
                console.log('Total posts after translation:', translatedPosts.length);
                console.log('Posts:', translatedPosts);

                // Set featured post (first translated post)
                setFeaturedPost(translatedPosts[0]);

                // Generate category filters
                generateCategoryFilters(posts);

                // Initialize pagination
                paginatePosts(currentPage);

                // Initialize filter functionality
                initializeFilters();

                // Initialize pagination functionality
                initializePagination();

                console.log('Blog posts processed and displayed');
            }

            waitForTranslations();
        }
        
        // Set featured post
        function setFeaturedPost(post) {
            const featuredTitle = document.getElementById('featured-title');
            const featuredExcerpt = document.getElementById('featured-excerpt');
            const featuredLink = document.getElementById('featured-link');
            
            if (featuredTitle && featuredExcerpt && featuredLink && post) {
                featuredTitle.textContent = post.title;
                featuredExcerpt.textContent = post.excerpt;
                featuredLink.href = post.url;
            }
        }
        
        // Generate category filters
        function generateCategoryFilters(posts) {
            const categoryFiltersContainer = document.getElementById('category-filters');
            if (!categoryFiltersContainer) return;
            
            const categories = new Set();
            posts.forEach(post => {
                if (post.categories && post.categories.length > 0) {
                    post.categories.forEach(category => categories.add(category));
                }
            });
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-button';
                button.setAttribute('data-filter', slugify(category));
                button.textContent = category;
                categoryFiltersContainer.appendChild(button);
            });
        }
        
        // Initialize filters
        function initializeFilters() {
            const filterButtons = document.querySelectorAll('.filter-button');
            
            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    filterButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const filterValue = this.getAttribute('data-filter');
                    filterInsights(filterValue);
                });
            });
        }
        
        // Filter insights
        function filterInsights(filter) {
            if (filter === 'all') {
                filteredPosts = allPosts;
            } else {
                filteredPosts = allPosts.filter(post => {
                    if (post.categories && post.categories.length > 0) {
                        return post.categories.some(category => slugify(category) === filter);
                    }
                    return false;
                });
            }
            
            currentPage = 1;
            paginatePosts(currentPage);
        }
        
        // Paginate posts - matching Jekyll behavior exactly
        function paginatePosts(page) {
            const insightsGrid = document.getElementById('insights-grid');
            if (!insightsGrid) return;
            
            insightsGrid.innerHTML = '';
            
            const startIndex = (page - 1) * postsPerPage;
            const endIndex = startIndex + postsPerPage;
            const postsToShow = filteredPosts.slice(startIndex, endIndex);
            
            console.log('Paginating posts - page:', page, 'postsToShow:', postsToShow.length, 'totalPosts:', filteredPosts.length);
            
            // Add blog post cards (only show posts that exist)
            postsToShow.forEach((post, index) => {
                if (!post || !post.title) {
                    console.warn('Skipping invalid post at index:', index, post);
                    return;
                }
                const card = createPostCard(post, index);
                insightsGrid.appendChild(card);
            });
            
            console.log('Cards created:', insightsGrid.children.length);
            
            // Note: Jekyll adds placeholder cards if posts.length < 3, but since we're using pagination,
            // we only show actual posts. This matches the behavior when pagination is active.
            
            // Generate pagination
            generatePagination();
        }
        
        // Create post card - matching Jekyll version exactly
        function createPostCard(post, index) {
            const svgBackgroundPattern =
                'data:image/svg+xml,%3Csvg width="60" height="60" ' +
                'viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" ' +
                'fill-rule="evenodd"%3E%3Cg fill="%233b82f6" fill-opacity="0.1"%3E%3Cpath d=' +
                '"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4z' +
                'M6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z"/%3E' +
                '%3C/g%3E%3C/g%3E%3C/svg%3E';

            const cardCol = document.createElement('div');
            cardCol.className = 'mb-4';

            if (post.categories && post.categories.length > 0) {
                cardCol.setAttribute('data-topic', slugify(post.categories[0]));
            }

            // Determine which visualization to use based on the post title and category
            const isEnterpriseAIPost = post.title && post.title.includes('Future of AI in Enterprise');
            const isMachineLearningPost = post.title && post.title.includes('Machine Learning for Business');

            // Update date for Machine Learning post if needed
            if (isMachineLearningPost) {
                post.date = 'January 10, 2025';
            }

            // Determine SVG index or type based on category
            let svgIndex = (index % 6) + 1;
            let visualType = 'standard';

            // Map categories to specific visualizations
            if (post.categories && post.categories.length > 0) {
                const category = post.categories[0].toLowerCase();
                if (category.includes('ai trends') || isEnterpriseAIPost) {
                    visualType = 'enterprise-ai';
                } else if (category.includes('machine learning') || isMachineLearningPost) {
                    visualType = 'machine-learning';
                } else if (category.includes('finance')) {
                    svgIndex = 'finance-industry';
                } else if (category.includes('healthcare')) {
                    svgIndex = 'healthcare-industry';
                } else if (category.includes('manufacturing')) {
                    svgIndex = 'manufacturing-industry';
                } else if (category.includes('energy')) {
                    svgIndex = 'energy-industry';
                } else if (category.includes('logistics')) {
                    svgIndex = 'logistics-industry';
                }
            }

            // Use the insight SVGs - path adjusted for Astro public folder
            const imagePath = `/assets/images/insights/insight-${svgIndex}.svg`;

            // Create the HTML for the card with appropriate visualization
            let cardImageHtml = '';

            if (visualType === 'enterprise-ai') {
                // Enterprise AI visualization (network nodes)
                cardImageHtml = `
                    <div class="insight-img" style="background: linear-gradient(135deg, #0f172a, #1e293b); position: relative; overflow: hidden;">
                        <!-- Background Pattern -->
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url(${svgBackgroundPattern}); opacity: 0.4;"></div>
                        
                        <!-- Glow Effect -->
                        <div style="position: absolute; top: 50%; left: 50%; width: 150px; height: 150px; background: radial-gradient(circle, rgba(59, 130, 246, 0.4) 0%, rgba(16, 185, 129, 0.1) 50%, transparent 70%); border-radius: 50%; filter: blur(40px); opacity: 0.6; transform: translate(-50%, -50%);"></div>
                        
                        <!-- Enterprise AI Mini Visualization -->
                        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="position: absolute; width: 100%; height: 100%;">
                            <!-- Central Node -->
                            <circle cx="100" cy="100" r="15" fill="url(#cardGradient${index}1)" />
                            
                            <!-- Connection Lines -->
                            <line x1="100" y1="100" x2="60" y2="60" stroke="#3b82f6" stroke-width="1.5" stroke-opacity="0.6" />
                            <line x1="100" y1="100" x2="140" y2="60" stroke="#3b82f6" stroke-width="1.5" stroke-opacity="0.6" />
                            <line x1="100" y1="100" x2="150" y2="100" stroke="#3b82f6" stroke-width="1.5" stroke-opacity="0.6" />
                            <line x1="100" y1="100" x2="140" y2="140" stroke="#3b82f6" stroke-width="1.5" stroke-opacity="0.6" />
                            <line x1="100" y1="100" x2="60" y2="140" stroke="#3b82f6" stroke-width="1.5" stroke-opacity="0.6" />
                            <line x1="100" y1="100" x2="50" y2="100" stroke="#3b82f6" stroke-width="1.5" stroke-opacity="0.6" />
                            
                            <!-- Satellite Nodes -->
                            <circle cx="60" cy="60" r="8" fill="url(#cardGradient${index}2)" />
                            <circle cx="140" cy="60" r="8" fill="url(#cardGradient${index}2)" />
                            <circle cx="150" cy="100" r="8" fill="url(#cardGradient${index}2)" />
                            <circle cx="140" cy="140" r="8" fill="url(#cardGradient${index}2)" />
                            <circle cx="60" cy="140" r="8" fill="url(#cardGradient${index}2)" />
                            <circle cx="50" cy="100" r="8" fill="url(#cardGradient${index}2)" />
                            
                            <!-- Definitions -->
                            <defs>
                                <linearGradient id="cardGradient${index}1" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#3b82f6" />
                                    <stop offset="100%" stop-color="#10b981" />
                                </linearGradient>
                                <linearGradient id="cardGradient${index}2" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#60a5fa" />
                                    <stop offset="100%" stop-color="#34d399" />
                                </linearGradient>
                            </defs>
                        </svg>
                        
                        <div class="insight-ai-overlay"></div>
                        <div class="insight-ai-pattern"></div>
                    </div>
                `;
            } else if (visualType === 'machine-learning') {
                // Machine Learning visualization (data flow/algorithm visualization)
                cardImageHtml = `
                    <div class="insight-img" style="background: linear-gradient(135deg, #1e293b, #0f172a); position: relative; overflow: hidden;">
                        <!-- Background Pattern -->
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url(${svgBackgroundPattern}); opacity: 0.4;"></div>
                        
                        <!-- Glow Effect -->
                        <div style="position: absolute; top: 50%; left: 50%; width: 150px; height: 150px; background: radial-gradient(circle, rgba(16, 185, 129, 0.4) 0%, rgba(59, 130, 246, 0.1) 50%, transparent 70%); border-radius: 50%; filter: blur(40px); opacity: 0.6; transform: translate(-50%, -50%);"></div>
                        
                        <!-- Machine Learning Visualization -->
                        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" style="position: absolute; width: 100%; height: 100%;">
                            <!-- Data Points -->
                            <circle cx="40" cy="60" r="4" fill="#60a5fa" />
                            <circle cx="50" cy="80" r="4" fill="#60a5fa" />
                            <circle cx="70" cy="50" r="4" fill="#60a5fa" />
                            <circle cx="60" cy="100" r="4" fill="#60a5fa" />
                            <circle cx="30" cy="90" r="4" fill="#60a5fa" />
                            <circle cx="80" cy="70" r="4" fill="#60a5fa" />
                            
                            <!-- Decision Boundary -->
                            <path d="M30,120 Q60,50 90,120" stroke="#f59e0b" stroke-width="2" fill="none" stroke-dasharray="4" />
                            
                            <!-- Algorithm Box -->
                            <rect x="100" y="70" width="60" height="60" rx="10" fill="url(#mlGradient${index})" />
                            <text x="130" y="105" text-anchor="middle" fill="white" font-size="14" font-weight="bold">ML</text>
                            
                            <!-- Arrows -->
                            <path d="M90,100 L100,100" stroke="#60a5fa" stroke-width="2" fill="none" marker-end="url(#arrowhead${index})" />
                            <path d="M160,100 L170,100" stroke="#10b981" stroke-width="2" fill="none" marker-end="url(#arrowhead${index})" />
                            
                            <!-- Definitions -->
                            <defs>
                                <marker id="arrowhead${index}" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                                    <polygon points="0 0, 10 3, 0 6" fill="#60a5fa" />
                                </marker>
                                <linearGradient id="mlGradient${index}" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" stop-color="#10b981" />
                                    <stop offset="100%" stop-color="#3b82f6" />
                                </linearGradient>
                            </defs>
                        </svg>
                        
                        <div class="insight-ai-overlay"></div>
                        <div class="insight-ai-pattern"></div>
                    </div>
                `;
            } else {
                // Standard image with enhanced styling
                cardImageHtml = `
                    <div class="insight-img" style="background: linear-gradient(135deg, #0f172a, #1e293b); position: relative; overflow: hidden;">
                        <!-- Background Pattern -->
                        <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: url(${svgBackgroundPattern}); opacity: 0.4;"></div>
                        
                        <!-- Glow Effect -->
                        <div style="position: absolute; top: 50%; left: 50%; width: 150px; height: 150px; background: radial-gradient(circle, rgba(59, 130, 246, 0.2) 0%, rgba(16, 185, 129, 0.1) 50%, transparent 70%); border-radius: 50%; filter: blur(40px); opacity: 0.4; transform: translate(-50%, -50%);"></div>
                        
                        <!-- Standard Image with Enhanced Styling -->
                        <img src="${imagePath}" alt="${post.title}" style="width: 100%; height: 100%; object-fit: cover; position: relative; z-index: 2; opacity: 0.8;">
                        
                        <div class="insight-ai-overlay"></div>
                        <div class="insight-ai-pattern"></div>
                    </div>
                `;
            }

            // Special handling for Machine Learning post date
            const displayDate = post.title && post.title.includes('Machine Learning for Business')
                ? 'January 10, 2025'
                : formatDate(post.date);

            const category = post.categories && post.categories.length > 0 ? post.categories[0] : '';

            // Get translated "Read More" text
            const currentLang = localStorage.getItem('bixingLanguage') || 'en';
            const readMoreText = currentLang === 'zh' ? '阅读更多' : 'Read More';

            const cardHtml = `
                <div class="insights-card">
                    ${cardImageHtml}
                    <div class="insights-content">
                        <div class="insights-date">${displayDate}</div>
                        ${category ? `<span class="insights-category">${category}</span>` : ''}
                        <h3 class="insights-title">${post.title}</h3>
                        <p class="insights-excerpt">${truncateText(post.excerpt, 120)}</p>
                        <a href="${post.url}" class="insights-read-more">${readMoreText} <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></a>
                    </div>
                </div>
            `;

            cardCol.innerHTML = cardHtml;
            return cardCol;
        }
        
        // Generate pagination - matching Jekyll behavior
        function generatePagination() {
            const paginationContainer = document.getElementById('pagination-container');
            if (!paginationContainer) return;
            
            const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
            const paginationUl = paginationContainer.querySelector('.pagination');
            if (!paginationUl) return;
            
            paginationUl.innerHTML = '';
            
            // Hide pagination if only one page (matching Jekyll)
            if (totalPages <= 1) {
                paginationContainer.style.display = 'none';
                return;
            } else {
                paginationContainer.style.display = 'flex';
            }
            
            // Previous button
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">Previous</a>`;
            paginationUl.appendChild(prevLi);
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                paginationUl.appendChild(li);
            }
            
            // Next button
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">Next</a>`;
            paginationUl.appendChild(nextLi);
        }
        
        // Initialize pagination
        function initializePagination() {
            const paginationContainer = document.getElementById('pagination-container');
            if (!paginationContainer) return;
            
            paginationContainer.addEventListener('click', function(e) {
                e.preventDefault();
                const pageLink = e.target.closest('.page-link');
                if (!pageLink) return;
                
                const page = parseInt(pageLink.getAttribute('data-page'));
                if (page && page !== currentPage && page > 0) {
                    const totalPages = Math.ceil(filteredPosts.length / postsPerPage);
                    if (page <= totalPages) {
                        currentPage = page;
                        paginatePosts(currentPage);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }
                }
            });
        }
        
        // Display error message
        function displayErrorMessage(message = 'Failed to load blog posts') {
            const insightsGrid = document.getElementById('insights-grid');
            if (insightsGrid) {
                insightsGrid.innerHTML = `<div class="col-span-full text-center text-white">${message}</div>`;
            }
        }
    })();
</script>

